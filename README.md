# Visiblyrics

Visiblyrics（ビジブリリックス）は、歌詞アニメーション動画を作成するためのElectronベースのデスクトップアプリケーションです。カラオケスタイルのテキストアニメーションをテンプレートベースで簡単に作成し、高品質な動画として出力できます。

## ⚠️ 開発段階について

**本アプリケーションは現在アルファ版（Alpha）段階です。**

- 機能の実装や仕様が未完成の部分があります
- 動作の安定性に問題がある可能性があります
- ユーザーインターフェースはまだ使いにくいと思います
- 予期しない不具合やデータ損失が発生する可能性があります
- 機能仕様や操作方法が予告なく変更される場合があります

本アプリケーションの使用は**完全に自己責任**でお願いいたします。重要なデータは事前にバックアップを取り、十分にテストを行った上でご利用ください。

興味をお持ちいただき、開発段階でのフィードバックをいただける方のご協力をお待ちしております。

## 機能

- 階層的なタイムライン編集（フレーズ、単語、文字単位）
- **歌詞編集機能**（テキスト・タイミング・フレーズ管理）
- テンプレートベースのアニメーションシステム
- リアルタイムプレビュー（PIXI.js WebGL レンダリング）
- 高品質な動画エクスポート（WebCodecs使用）
- **柔軟な出力範囲設定**（全区間・指定時間範囲の選択出力）
- カスタマイズ可能なテンプレートパラメータ
- 音声ファイル対応とタイミング同期
- プロジェクトファイル保存・読み込み機能
- デスクトップアプリケーションとしての快適な操作性

## インストール方法

### 必要な環境

- Node.js 18以上
- npm
- Electron対応OS（Windows、macOS、Linux）

### セットアップ

1. リポジトリをクローン
```bash
git clone https://github.com/sousakujikken/visiblyrics.git
cd visiblyrics
```

2. 依存関係をインストール
```bash
npm install
```

3. アプリケーションをビルド
```bash
npm run build
```

## 起動方法

### 開発モードでの起動

開発時は以下の2つのコマンドを**それぞれ別のターミナル**で実行します：

1. **開発用ビルドプロセスの起動**
```bash
npm run dev
```
このコマンドでRenderer（UI）の開発サーバーとMain（Electron）プロセスのビルド（watch mode）が並行実行されます。

2. **Electronアプリケーションの起動**

別のターミナルで下記のコマンドを実行してElectronアプリケーションを起動します。
```bash
npm run electron
```

### アプリケーションのパッケージ化（未検証）

```bash
npm run package      # 現在のプラットフォーム用
npm run package:all  # 全プラットフォーム用（Windows、macOS、Linux）
```

## 使い方

### 基本的な操作手順

1. **アプリケーションの起動**
   - Electronアプリケーションを起動すると、メインウィンドウが表示されます

2. **音声ファイルの読み込み**
   - 「音楽」タブから音声ファイル（MP3、WAVなど）をドラッグ&ドロップまたは選択
   - 波形が表示され、再生コントロールが利用可能になります

3. **歌詞の入力と編集**
   - 別途作成した歌詞ファイルを「歌詞」タブからJSONファイル読み込みボタンで読み込み
   - 「歌詞を編集」ボタンから歌詞エディタを開き、歌詞データを直接編集可能
   - 歌詞エディタでは以下の操作が可能：
     - フレーズテキストの編集（クリックで編集モード）
     - 開始・終了時刻の調整（ミリ秒単位）
     - フレーズの削除
     - 変更内容のリアルタイム反映とプロジェクト保存

### 歌詞データについて

歌詞データの詳細な仕様については、[docs/lyricsdata_format.md](./docs/lyricsdata_format.md) を参照してください。

#### 歌詞データの作成方法

正確なタイミング情報を含む歌詞データを作成するには、以下の方法を推奨します：

1. **音声ファイルの準備**
   - 対象楽曲のボーカルトラックをSTEM分離ツールで抽出
   - ボーカルのみの音声ファイルを準備

2. **LLMを使用した歌詞データ生成**
   - Gemini 2.5 proなどのマルチモーダル対応LLMを使用
   - 以下のデータをLLMに提供：
     - ボーカルトラックの音声ファイル
     - 歌詞のテキストデータ
     - `src/renderer/data/testLyrics.json` をサンプルとして提示
   - LLMに対してVisiblyrics形式の歌詞データ生成を依頼

この手法により、フレーズ・単語・文字レベルでの精密なタイミング情報を含む歌詞データを効率的に作成できます。

4. **タイミングの設定**
   - タイムライン上でフレーズマーカーをドラッグして開始/終了時間を調整
   - 階層構造（フレーズ→単語→文字）でより細かいタイミング制御が可能

5. **テンプレートの適用**
   - 「テンプレート」タブでアニメーションテンプレートを選択
   - 選択したフレーズまたは全フレーズにテンプレートを適用

6. **パラメータの調整**
   - パラメータエディタで各テンプレートの詳細設定を調整
   - リアルタイムプレビューで即座に結果を確認

### 個別オブジェクトのパラメータアクティベーション機能

Visiblyricsでは、グローバル設定とは別に、個別のフレーズ・単語・文字に独自のパラメータを設定できます。この機能には「アクティベーション」という仕組みがあり、明示的にアクティブ化されたオブジェクトのみが個別設定を優先的に使用します。

#### アクティベーションの使い方

1. **個別オブジェクトの選択**
   - タイムライン上でフレーズ、単語、または文字マーカーをクリックして選択
   - 複数選択も可能（Shift+クリックまたはCtrl/Cmd+クリック）

2. **テンプレートタブでの設定**
   - 「選択オブジェクト設定」モードに切り替え
   - 「アクティブ化」ボタンをクリックして、選択したオブジェクトをアクティブ化
   - アクティブ化されたオブジェクトは**緑色のマーカー**で表示される

3. **個別パラメータの編集**
   - アクティブ化後、パラメータエディタで個別の設定を調整
   - これらの設定はグローバル設定より優先される

4. **アクティベーションの解除**
   - 「アクティブ化解除」ボタンで個別設定を無効化
   - 解除すると、そのオブジェクトはグローバル設定を使用するようになる

#### 使用上の注意事項

1. **優先順位の理解**
   - アクティブ化されていないオブジェクト → **グローバル設定**が適用
   - アクティブ化されたオブジェクト → **個別設定**が優先

2. **個別設定の保持**
   - アクティブ化を解除しても、個別パラメータの値は保持される
   - 再度アクティブ化すると、以前の個別設定が復活する

3. **視覚的な確認**
   - タイムラインマーカーの色で状態を確認：
     - **通常色**：グローバル設定を使用
     - **緑色**：アクティブ化済み（個別設定を使用）

4. **一括管理機能**
   - 「全個別設定を強制クリア」：すべてのアクティベーションと個別設定を削除
   - プロジェクトが複雑になった場合のリセット用

5. **パフォーマンスへの配慮**
   - 多数のオブジェクトを個別にアクティブ化すると、管理が複雑になる
   - 必要な部分のみアクティブ化することを推奨

#### 活用例

- **特定フレーズの強調**：サビ部分のみフォントサイズを大きくする
- **色の変化**：特定の単語だけ異なる色にする
- **アニメーション速度の調整**：重要な歌詞はゆっくり表示する

この機能により、統一感を保ちながら、部分的に個性的な演出を加えることができます。

7. **動画のエクスポート**
   - 「エクスポート」タブで解像度、フレームレート、品質を設定
   - **出力範囲の選択**：
     - 「選択区間を出力」チェックボックスで全区間 or 指定範囲を選択
     - チェック時は開始時間・終了時間を「MM:SS.mmm」形式で指定可能
     - 部分的なプレビューや特定シーンの抽出に便利
   - 「エクスポート開始」で動画ファイルを生成・保存

### プロジェクトファイルの管理

- **保存**: 「保存」タブまたはCtrl/Cmd + S でプロジェクトを保存（.vly形式）
- **開く**: ファイルメニューまたはドラッグ&ドロップで既存プロジェクトを開く
- **自動保存**: 作業中の変更は自動的に保存されます
- **エクスポート**: プロジェクトデータのJSONエクスポート機能

## テンプレート開発

新しいアニメーションテンプレートを作成する場合は、以下のドキュメントを参照してください：

📚 **テンプレート実装ガイド**: `/docs/template-implementation-guide.md`

このガイドには以下の内容が含まれています：
- テンプレートの基本構造
- 階層アニメーションモデルの説明
- 実装に必要なメソッドの詳細
- サンプルコード

## プロジェクト構造

```
visiblyrics/
├── src/
│   ├── components/    # UIコンポーネント
│   ├── engine/        # アニメーションエンジン
│   ├── templates/     # アニメーションテンプレート
│   ├── types/         # TypeScript型定義
│   └── export/        # 動画エクスポート機能
├── docs/             # ドキュメント
└── public/           # 静的ファイル
```

## 開発コマンド

```bash
npm run dev              # 開発モード起動（Renderer + Main）
npm run dev:renderer     # Rendererプロセスのみ開発モード
npm run dev:main         # Mainプロセスのみビルド（watch）
npm run build            # プロダクションビルド
npm run build:renderer   # Rendererプロセスビルド
npm run build:main       # Mainプロセスビルド
npm run lint             # ESLintの実行
npm run electron         # Electronアプリ起動
npm run package          # アプリパッケージ化
npm run package:all      # 全プラットフォーム向けパッケージ化
```

## ライセンス

このソフトウェアは GNU General Public License v3.0 (GPL-3.0) の下でライセンスされています。

詳細については、[LICENSE](./LICENSE) ファイルを参照してください。

### GPL-3.0 ライセンスについて

- このソフトウェアを自由に使用、研究、共有、改変することができます
- 改変版を配布する場合は、同じGPL-3.0ライセンスを適用する必要があります
- 商用利用も可能ですが、ソースコードの開示が必要です

Copyright (C) 2025 Visiblyrics Project

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

## 貢献

プルリクエストを歓迎します。大きな変更を行う場合は、まずissueを作成して変更内容について議論してください。

## サポート

問題が発生した場合は、GitHubのissueセクションで報告してください。